# ChatRoom

计算机网络综合项目

## 协议设计

### 客户端至服务端

#### C1 请求登录

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`i`|
|`string`|16|请求登录的用户名，长度不足填充`0`|
|`string`|16|请求登录的密码的16位小写MD5|

#### C2 请求在线用户列表

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`u`|

#### C3 请求在线群组列表

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`g`|

#### C4 请求创建群组

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`c`|
|`string`|16|请求创建的群组名称，长度不足填充`0`|

#### C5 请求加入群组

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`j`|
|`long`|8|请求加入的群组ID|

#### C6 请求邀请他人加入群组

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`v`|
|`long`|8|邀请加入的群组ID|
|`long`|8|邀请加入的用户ID|

#### C7 请求离开群组

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`e`|
|`long`|8|请求离开的群组ID|

#### C8 请求发送消息

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`m`|
|`long`|8|发送消息的目标群组ID|
|`string`|16X|发送的消息，长度必须是16的倍数，最后一个字节必须是`0`|

#### C9 回复他人请求加入群组

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`o`|
|`long`|8|回复的请求ID|
|`byte`|1|是否同意|

#### CA 请求群组成员列表

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`b`|
|`long`|8|请求的群组ID|

### 服务端至客户端

#### S1 回复请求登录

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`i`|
|`long`|8|当前用户ID，若为`0`，表示登录失败|

#### S2 回复请求在线用户列表

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`u`|
|`long`|8|某个用户的ID|
|`string`|16|某个用户的用户名，长度不足填充`0`|

最后两个字段会重复多次。

#### S3 回复请求群组列表

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`g`|
|`long`|8|某个群组的ID|
|`string`|16|某个群组的名称，长度不足填充`0`|
|`byte`|1|某个群组的信息标记

关于最后一个字段：
 - 第0位表示当前用户是否已经加入了该群组
 - 第1位表示当前用户是否是该群组的创建者

最后三个字段会重复多次。

#### S4 通知他人请求加入群组

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`o`|
|`long`|8|请求加入的群组ID|
|`long`|8|请求加入的用户ID|
|`long`|8|请求ID|

#### S5 回复请求加入群组

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`j`|
|`byte`|1|表示加入是否成功以及原因，具体取值及含义参见下文|
|`long`|8|加入的群组ID|

关于第二个字段：
 - `0` 表示加入请求被创建者拒绝
 - `1` 表示加入请求被创建者同意
 - `2` 表示当前用户就是创建者，自动加入群组
 - `3` 表示被创建者邀请加入群组

#### S6 通知已离开群组

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`e`|
|`long`|8|离开的群组ID|

#### S7 通知收到消息

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`m`|
|`long`|8|消息来源的群组ID|
|`long`|8|消息来源的用户ID|
|`string`|16X|消息文本，长度必须是16的倍数，且最后一个字节必须是`0`|

#### S8 回复请求群组成员列表

|类型|长度（字节）|描述|
|:---:|:---:|-----|
|`byte`|1|固定为`b`|
|`long`|8|请求的群组ID
|`long`|8|某个用户的ID|
|`string`|16|某个用户的用户名，长度不足填充`0`|
|`byte`|1|某个用户的信息标记

关于最后一个字段：
 - 第0位表示该用户是否已经加入了该群组
 - 第1位表示该用户是否是该群组的创建者

最后三个字段会重复多次。

## 相关流程

### 用户请求加入群组

 - C5 客户端发送请求
 - S4 服务端征求群组创建者的意见
 - C9 群组创建者回复是否同意
 - S5 服务端将是否同意传达给客户端
